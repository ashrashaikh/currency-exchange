# Currency Exchange and Discount Calculation Service
This Spring Boot application integrates with a third-party currency exchange API to retrieve
real-time exchange rates. The application provides an API to calculate the payable amount for
a bill in a specified target currency after applying applicable discounts.

## Discount Rules
1. **Percentage-based discounts** (applied only once per bill):
   Groceries are excluded from percentage-based discounts.
   - Employee: If the user is an employee of the store, they get a 30% discount.
   - Affiliate: If the user is an affiliate of the store, they get a 10% discount.
   - Customer for 2+ years: If the user has been a customer for over 2 years, they get a 5% discount.
2. **Flat discount**: $5 additional discount for every $100 spent on the bill.


## Getting Started
### Prerequisites
- **Java 17+**
- **Maven 3.6+**
- **API key (App ID) for** [Open Exchange Rates](https://openexchangerates.org/).
- **InteliJ IDE - Latest version**

### Setup
1. **Clone the repository:**

   `git clone https://github.com/ashrashaikh/currency-exchange.git`

   Change directory to the currency-exchange repository in your local machine. `cd currency-exchange`


2. **Build the application:**

   `mvn clean install`


3. In the Application **Run Configuration** VM options in IntelliJ, add the **OPEN_EXCHANGE_RATE_API_KEY** with your OpenExchangeRate App ID.

   This value will be picked by `open.exchange.rate.api.key` in the application.yaml file.
   - Example, `-DOPEN_EXCHANGE_RATE_API_KEY=YOUR-APP-ID`


4. **Run the application:**

   `mvn spring-boot:run`


5. **Testing:**
   > **Run unit test cases.**
   > `mvn test`
   >>_Using **JUnit 5** to write unit test cases._
   >>
   >>_Using **Mockito** to mock the services for testing purpose._
   >>
   >> _Using **Jacoco** to generate the code coverage report._

   > **Generate a Jacoco code coverage report.**
   > `mvn clean verify`
   >
   > This will:
   >> Execute the test cases.
   >>
   >> Generate a code coverage report in the following location:
   > `target/site/jacoco/index.html`


## API Documentation

### Amount Calculation Endpoint:

#### Endpoint:
Calculates the payable amount after applying the discounts and the latest currency conversion rate.
- http://localhost:8080/api/calculate

#### HTTP Method:
- POST

#### Request Header:
```
--header 'Authorization: Basic AUTH-TOKEN'
--header 'content-type: application/json'
```
> **AUTH-TOKEN** can be generated by providing the application username and password in the Request Header (in Postman or Bruno).

#### Request Body:
Example:
```
{
  "originalCurrency": "USD",
  "targetCurrency": "INR",
  "totalAmount": 172.00,
  "userType": "EMPLOYEE",
  "customerTenure": 3,
  "items": [
    {
      "name": "Milk",
      "category": "GROCERIES",
      "price": 2.00
    },
    {
      "name": "Air Fryer",
      "category": "ELECTRONICS",
      "price": 170.00
    }
  ]
}
```

#### Response:
```
{
  "targetCurrency": "INR",
  "payableAmount": 9799.41958
}
```

### API Integration Details

#### Third-Party API: [Open Exchange Rates](https://openexchangerates.org/)

#### Endpoint:
> Using [Latest](https://docs.openexchangerates.org/reference/latest-json) API Endpoint
>
> Example: https://openexchangerates.org/api/latest.json?app_id=your-api-key&base=USD


